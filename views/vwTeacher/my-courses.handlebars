{{#fill_section 'css'}}
<link rel="stylesheet" href="/statics/css/student/student-my-courses.css">
{{/fill_section}}

<section class="profile-header">
  <div class="container">
    <div class="d-flex align-items-center gap-3">
      <img src="{{user.avatar_url}}"
          onerror="this.onerror=null; this.src='https://cdn-icons-png.flaticon.com/512/847/847969.png';"
          class="profile-avatar" alt="User avatar" />
      <div>
        <h2 class="mb-1">{{user.name}}</h2>
        <p class="mb-0 opacity-75">{{user.email}}</p>
      </div>
    </div>
  </div>
</section>

<section class="py-5">
  <div class="container">
    <div class="row g-4">

      <div class="col-lg-9">
        <div class="profile-content">
          <h4 class="mb-4">Khóa học của tôi ({{enrolledCourses.length}})</h4>

          {{#if enrolledCourses.length}}
          <div class="enrolled-courses-container">
            {{#each enrolledCourses}}
            <div class="course-card-horizontal">
              <img src="{{course.thumbnail_url}}" class="course-card-thumbnail" alt="{{course.title}}">
              <div class="course-card-content">
                <span class="badge bg-primary mb-2">{{course.category.name}}</span>
                <h5 class="mb-1">{{course.title}}</h5>
                <div class="d-flex align-items-center gap-2 text-muted mb-2">
                  <img src="{{course.teacher.avatar_url}}" class="teacher-mini" alt="{{course.teacher.full_name}}">
                  <span>{{course.teacher.full_name}}</span>
                </div>

                <div class="course-meta mb-3">
                  <span class="me-3">⭐ {{course.rating_avg}} ({{formatNumber course.rating_count}})</span>
                  <span class="me-3"><i class="bi bi-people"></i> {{formatNumber course.view_count}} lượt xem</span>
                  <span><i class="bi bi-cash"></i> {{formatCurrency course.discount_price}}</span>
                </div>

                <div class="course-progress">
                  <div class="d-flex justify-content-between mb-2">
                    <span class="small">Tiến độ học</span>
                    <span class="small fw-bold">{{progress}}%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar bg-success" style="width: {{progress}}%"></div>
                  </div>
                </div>

                <div class="mt-3">
                  <a href="/student/learn/{{course.id}}" class="btn btn-primary">
                    {{#if (eq progress 0)}}
                    Bắt đầu học
                    {{else if (lt progress 100)}}
                    Tiếp tục học
                    {{else}}
                    Xem lại
                    {{/if}}
                  </a>
                  {{#if (and total_lectures (eq completed_lectures total_lectures) (gt total_lectures 0))}}
                  <button class="btn btn-outline-primary ms-2" onclick="rateCourse('{{course.id}}')">
                    <i class="bi bi-star"></i> Đánh giá
                  </button>
                  {{/if}}
                </div>
              </div>
            </div>
            {{/each}}
          </div>
          {{else}}
          <div class="empty-state">
            <i class="bi bi-book"></i>
            <h5>Chưa có khóa học nào</h5>
            <p>Bạn chưa đăng ký khóa học nào. Hãy khám phá và tìm khóa học phù hợp!</p>
            <a href="/courses" class="btn btn-primary">Khám phá khóa học</a>
          </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</section>

{{#fill_section 'js'}}
<script>
  function rateCourse(courseId) {
    alert('Chức năng đánh giá khóa học đang được phát triển');
  }
</script>
{{/fill_section}}
